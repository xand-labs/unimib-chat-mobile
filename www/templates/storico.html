<ion-view title="UNIMIB Chat">
  <ion-nav-buttons side="left">
    <button menu-toggle="left" class="button button-icon icon ion-navicon"></button>
  </ion-nav-buttons>
 
  <ion-content id="io-scrollo" class="has-header ">


    <div class="card" ng-show="!identificato">
      <div class="item item-divider">
        Accedi alla Chat
      </div>
      <div class="item item-text-wrap">
        <p>Utilizza il tuo account Google universitario per accedere alla Chat.</p>
        <button ng-show="!accessoInCorso" class="button button-assertive button-block" ng-click="effettuaLogin();">
          <i class="ion-ok-circled"></i> Entra con Google
        </button>
        <div ng-show="accessoInCorso">
          <i class="icon ion-loading-c"></i> Accesso in corso...
        </div>

      </div>

    </div>

    <div ng-show="identificato" id="storico">

          <div ng-repeat="msg in messaggi" class="row riga {{ msg.tipo }}" data-rid="{{ msg.rid }}" data-tipo="{{ msg.tipo }}">

            <div class="col col-10 data" ng-if="msg.tipo != 'msg'">{{ msg.data | date: 'H:mm' }}</div>

            <!-- Messaggi normali -->
            <div class="col col-33 azzerapadding" ng-if="msg.tipo == 'msg'">
              <div class="row azzerapadding" ng-if="msg.tipo == 'msg'">
                <div class="col col-33 data" ng-if="msg.tipo == 'msg'">{{ msg.data | date: 'H:mm' }}</div>
                <div ng-if="msg.tipo == 'msg' && msg.autore"  class="col col-67 autore autore-altrui">{{msg.autore}}</div>
                <div ng-if="msg.tipo == 'msg' && !msg.autore" class="col col-67 autore autore-me">Tu</div>
              </div>
              <div class="row tags azzerapadding" ng-if="msg.tipo == 'msg'">
                <span class="tag tag-msg" ng-repeat="tag in msg.tags">#{{tag}}</span>
              </div>
            </div>

            <div ng-if="msg.tipo == 'msg'" class="col col-67 messaggio" ng-bind-html="msg.messaggio">
            </div>

            <!-- Join -->
            <div ng-if="msg.tipo == 'join'" class="col col-90 messaggio">
              <i class="ion-plus-circled"></i> Hai iniziato a seguire: 
              <span class="tag tag-jl" ng-repeat="tag in msg.tags">#{{tag}}</span>
            </div>

            <!-- Leave -->
            <div ng-if="msg.tipo == 'leave'" class="col col-90 messaggio">
              <i class="ion-minus-circled"></i> Smesso di seguire: 
              <span class="tag tag-jl" ng-repeat="tag in msg.tags">#{{tag}}</span>
            </div>

            <!-- Sistema -->
            <div ng-if="msg.tipo == 'sys'" class="col col-90 messaggio" ng-bind-html="msg.messaggio">
            </div>

          </div>

    </div>

  </ion-content>


  <ion-footer-bar align-title="left" class="item-input-inset">
    <form class="item-input-wrapper" ng-submit="inviaMessaggio();">

      <i class="icon ion-paper-airplane placeholder-icon"></i>

      <input type="text" ng-model="messaggio.testo" maxlenght="{{ messaggio.max }}" 
        name="messaggio" placeholder="Scrivi un messaggio..." 
        id="campo-testo" />

    </form>
	</ion-footer-bar>

</ion-view>
